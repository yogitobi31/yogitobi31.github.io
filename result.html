<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>결과 - 별바람 이름 테스트</title>
  <meta property="og:title" content="나의 별바람 이름 결과" />
  <meta property="og:type" content="website" />
  <meta property="og:description" content="나의 성향으로 탄생한 이름과 캐릭터를 확인해보세요!" />
  <meta property="og:image" content="assets/og_default.png" />
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/png" sizes="512x512" href="favicon-512.png">
  <meta property="og:image" content="og-default.png">
  <meta property="og:title" content="별바람 이름 테스트">
  <meta property="og:description" content="15문항 성향기반, 나만의 이름과 귀여운 캐릭터">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4918757223156683"
     crossorigin="anonymous"></script>
</head>
<body>
  <header class="container">
    <h1>당신의 결과</h1>
  </header>

  <main class="container card result">
    <canvas id="charCanvas" width="900" height="900" class="canvas"></canvas>
    <div class="result-text">
      <h2 id="nameText">이름 로딩중...</h2>
      <p id="blurb">당신의 성향을 분석 중...</p>
      <div class="tags" id="tags"></div>
      <div class="btn-row">
        <button class="btn primary" id="downloadBtn">이미지 저장</button>
        <button class="btn ghost" id="shareBtn">공유하기</button>
        <button class="btn" onclick="location.href='index.html'">다시 하기</button>
        <!-- 새 버튼 -->
        <button class="btn" id="makeStory">스토리 포스터</button>
        <button class="btn" id="makeFeed">피드 포스터</button>
      </div>
    </div>
  </main>

  <section class="container ad card">
    <!-- 네이티브 광고 자리 -->
    <div class="ad-placeholder">여기에 광고가 표시됩니다</div>
  </section>

  <footer class="container footer">
    <a href="index.html">다시 테스트하기</a> · <a href="privacy.html">개인정보처리방침</a>
  </footer>

  <script src="data/name_parts.js"></script>
  <script src="data/character_layers.js"></script>
  <script src="app_result.js"></script>

  <!-- SNS 포스터 생성 기능 -->
  <script>
  (function(){
    const srcCanvas = document.getElementById('charCanvas');
    const nameEl = document.getElementById('nameText');
    const siteTitle = '별바람 이름 테스트';
    const siteUrl = 'yogitobi31.github.io';

    function drawPoster(w, h){
      const poster = document.createElement('canvas');
      poster.width = w; poster.height = h;
      const ctx = poster.getContext('2d');

      // 배경 그라데이션
      const g = ctx.createLinearGradient(0,0,0,h);
      g.addColorStop(0, '#fff8e1');
      g.addColorStop(1, '#fdebd2');
      ctx.fillStyle = g;
      ctx.fillRect(0,0,w,h);

      // 테두리
      ctx.strokeStyle = 'rgba(0,0,0,0.06)';
      ctx.lineWidth = Math.max(6, Math.round(w*0.006));
      ctx.strokeRect(ctx.lineWidth/2, ctx.lineWidth/2, w-ctx.lineWidth, h-ctx.lineWidth);

      // 상단 타이틀
      ctx.fillStyle = '#7b4f1d';
      ctx.font = `bold ${Math.round(w*0.05)}px system-ui, Arial`;
      ctx.textAlign = 'center';
      ctx.fillText(siteTitle, w/2, Math.round(h*0.08));

      // 캐릭터 붙이기
      const box = Math.min(w*0.75, h*0.55);
      const x = (w - box)/2;
      const y = Math.round(h*0.12);
      ctx.save();
      const r = Math.round(box*0.04);
      ctx.beginPath();
      ctx.moveTo(x+r,y);
      ctx.arcTo(x+box,y,x+box,y+box,r);
      ctx.arcTo(x+box,y+box,x,y+box,r);
      ctx.arcTo(x,y+box,x,y,r);
      ctx.arcTo(x,y,x+box,y,r);
      ctx.closePath();
      ctx.clip();
      ctx.drawImage(srcCanvas, 0,0,srcCanvas.width,srcCanvas.height, x,y, box,box);
      ctx.restore();

      // 이름
      const name = (nameEl?.textContent || '').trim() || '나의 영혼의 이름';
      ctx.fillStyle = '#1f2937';
      ctx.font = `700 ${Math.round(w*0.045)}px system-ui, Arial`;
      ctx.textAlign = 'center';
      ctx.fillText(name, w/2, y + box + Math.round(h*0.08), w*0.9);

      // 하단 텍스트
      ctx.fillStyle = '#6b7280';
      ctx.font = `500 ${Math.round(w*0.028)}px system-ui, Arial`;
      ctx.fillText('나의 성향으로 만든 이름 & 캐릭터', w/2, h - Math.round(h*0.12));
      ctx.font = `600 ${Math.round(w*0.03)}px system-ui, Arial`;
      ctx.fillStyle = '#7b4f1d';
      ctx.fillText(siteUrl, w/2, h - Math.round(h*0.06));

      return poster;
    }

    function saveCanvasAsPng(canvas, filename){
      const a = document.createElement('a');
      a.download = filename;
      a.href = canvas.toDataURL('image/png');
      a.click();
    }

    document.getElementById('makeStory')?.addEventListener('click', ()=>{
      const c = drawPoster(1080, 1920);
      saveCanvasAsPng(c, '별바람_스토리.png');
    });
    document.getElementById('makeFeed')?.addEventListener('click', ()=>{
      const c = drawPoster(1200, 630);
      saveCanvasAsPng(c, '별바람_피드.png');
    });
  })();
  </script>
</body>
</html>
