<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>결과 - 별바람 이름 테스트 (Safe)</title>

  <meta name="description" content="나의 성향으로 탄생한 영혼의 이름과 캐릭터를 확인해보세요!" />
  <link rel="icon" type="image/png" sizes="512x512" href="favicon-512.png" />

  <style>
    :root { --ink:#1f2937; --muted:#6b7280; --brand:#7b4f1d; --card:#fffaf0; --line:#ffe4b5; }
    html,body{margin:0;padding:0;background:#fefcf8;color:var(--ink);font-family:system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif}
    .container{max-width:1024px;margin:0 auto;padding:16px}
    .card{background:#fff;border:1px solid #eee;border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,.06);padding:16px}
    header.container{padding:20px 16px}
    h1{margin:0 0 6px;font-size:22px}
    .subtle{color:var(--muted);margin:0 0 14px;font-size:14px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;align-items:start}
    @media (max-width:900px){ .grid{grid-template-columns:1fr} }
    canvas{max-width:100%;border-radius:12px;background:#fff}
    .btn-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .btn{border:0;border-radius:10px;padding:10px 14px;cursor:pointer}
    .btn.primary{background:var(--brand);color:#fff}
    .btn.ghost{background:#f3f4f6}
    .tags{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0}
    .tags span{background:#f3f4f6;border-radius:999px;padding:6px 10px;font-size:12px;color:#374151}
    .quote-card{border-radius:16px;padding:18px 20px;background:var(--card);border:1px solid var(--line);box-shadow:0 6px 18px rgba(0,0,0,.06);margin-top:14px}
    .quote-card small{color:#9CA3AF;letter-spacing:.3px}
    .quote-text{font-size:18px;line-height:1.5;font-weight:600;color:#374151;margin:10px 0}
    .quote-footer{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .quote-footer a{font-size:12px;color:#2563EB;text-decoration:underline;white-space:nowrap}
    .tip{font-size:12px;color:#9CA3AF;margin-top:8px}
    .ad-placeholder{text-align:center;color:#9CA3AF;padding:12px 0;border:1px dashed #e5e7eb;border-radius:10px}
    /* 하단 오류 박스 */
    .err{position:fixed;left:8px;right:8px;bottom:8px;background:#fff3cd;color:#111;border:1px solid #ffecb5;border-radius:10px;padding:10px;font-size:12px;z-index:9999}
  </style>
</head>
<body>
  <header class="container">
    <h1>당신의 결과 (안전 모드)</h1>
    <p class="subtle">외부 스크립트 없이도 보이도록 구성했습니다. 보이면 파이프라인은 정상입니다.</p>
  </header>

  <main class="container card">
    <div class="grid">
      <div>
        <canvas id="charCanvas" width="900" height="900"></canvas>
        <div class="btn-row">
          <button class="btn primary" id="downloadBtn">이미지 저장</button>
          <button class="btn ghost" id="shareBtn">공유하기</button>
          <button class="btn" onclick="location.href='index.html'">다시 하기</button>
        </div>
        <div class="tip">* 저장한 이미지는 인스타/카톡 스토리에 잘 맞아요.</div>
      </div>

      <div>
        <h2 id="nameText">이름 로딩중…</h2>
        <p id="blurb">성향을 분석 중…</p>
        <div id="tags" class="tags"></div>

        <section id="wisdom" class="quote-card"></section>

        <div style="margin-top:12px" class="ad-placeholder">여기에 광고가 표시됩니다</div>
      </div>
    </div>
  </main>

  <section class="container card" style="margin-top:18px;">
    <div class="ad-placeholder">여기에 광고가 표시됩니다</div>
  </section>

  <footer class="container" style="padding:12px 16px 28px;color:#9CA3AF">
    <a href="index.html">다시 테스트하기</a> · <a href="privacy.html">개인정보처리방침</a> · <a href="terms.html">이용약관</a>
  </footer>

  <script>
    // ===== 오류도 화면에 표시 (무조건 보이게) =====
    window.onerror = function(msg, src, line, col){
      const box = document.createElement('div');
      box.className = 'err';
      box.innerHTML = '<b>오류 감지</b><br>'+ msg + '<br><small>'+ (src||'inline') +':'+ (line||0) +':'+ (col||0) +'</small>';
      document.body.appendChild(box);
    };

    // ===== 로컬스토리지에서 결과 읽기(없어도 안 죽음) =====
    function getPayload(){
      try{
        const p = JSON.parse(localStorage.getItem('resultPayload')||'null');
        return p && typeof p === 'object' ? p : null;
      }catch(e){ return null; }
    }
    const payload = getPayload();
    const axes = payload?.axes || null;

    // ===== 아주 간단한 이름/설명 생성 (임시) =====
    function fallbackName(a){
      if(!a) return '별바람의 손님';
      const themes = ['바람','불','대지','물','별'];
      const score = [
        (a.free||0)+0.3*(a.dreamy||0),
        (a.lively||0)+0.2*(a.extra||0),
        (a.warm||0)+0.2*(1-(a.free||0)),
        (1-(a.extra||0)),
        (a.dreamy||0)+0.2*(a.free||0)
      ];
      const idx = score.indexOf(Math.max(...score));
      return ['자유로운 바람','타오르는 불꽃','따스한 대지','깊은 물결','밤하늘의 별빛'][idx] + '의 이름';
    }

    // ===== 캔버스에 심플한 일러스트(임시) =====
    (function draw(){
      const c = document.getElementById('charCanvas');
      const ctx = c.getContext('2d');
      ctx.fillStyle = '#fff8e1'; ctx.fillRect(0,0,c.width,c.height);
      ctx.fillStyle = '#ffd28b'; ctx.beginPath(); ctx.arc(450,420,220,0,Math.PI*2); ctx.fill();
      ctx.fillStyle = '#6d4c41'; ctx.font = 'bold 42px system-ui, Arial'; ctx.textAlign = 'center';
      ctx.fillText('⭐ SPIRIT NAME ⭐', 450, 120);
      ctx.font = '28px system-ui, Arial';
      ctx.fillText((payload && payload.seed) ? ('seed '+String(payload.seed).slice(0,8)+'…') : 'no-seed', 450, 860);
    })();

    // ===== 텍스트/태그 =====
    document.getElementById('nameText').textContent = fallbackName(axes);
    document.getElementById('blurb').textContent = axes
      ? '당신의 성향 데이터를 불러왔어요. 아래 태그를 확인해 보세요.'
      : '임시 표시: 아직 성향 데이터가 없어요. 메인에서 설문 완료 후 다시 와주세요.';
    const tags = document.getElementById('tags');
    tags.innerHTML = axes
      ? `<span>free: ${(axes.free*100|0)}%</span><span>extra: ${(axes.extra*100|0)}%</span>
         <span>lively: ${(axes.lively*100|0)}%</span><span>warm: ${(axes.warm*100|0)}%</span>
         <span>dreamy: ${(axes.dreamy*100|0)}%</span>`
      : `<span>데이터 없음</span>`;

    // ===== 공유/저장 =====
    document.getElementById('shareBtn').addEventListener('click', async ()=>{
      try{
        const url = location.href;
        if(navigator.share){ await navigator.share({title:'별바람 이름 테스트', text:'내 영혼의 이름을 확인해보세요!', url}); }
        else { await navigator.clipboard.writeText(url); alert('링크가 복사되었습니다!'); }
      }catch(e){}
    });
    document.getElementById('downloadBtn').addEventListener('click', ()=>{
      const c = document.getElementById('charCanvas');
      try{
        const a = document.createElement('a');
        a.download = 'spirit-name.png';
        a.href = c.toDataURL('image/png');
        a.click();
      }catch(e){ alert('이미지 저장을 지원하지 않는 브라우저예요. 캡처를 사용해 주세요.'); }
    });

    // ===== 성향→테마 & 명언(영+한) =====
    function pickThemeByAxes(a){
      if(!a) return 'star';
      const scores = [
        {theme:'wind',  v:(a.free||0)+0.3*(a.dreamy||0)},
        {theme:'fire',  v:(a.lively||0)+0.2*(a.extra||0)},
        {theme:'earth', v:(a.warm||0)+0.2*(1-(a.free||0))},
        {theme:'water', v:(1-(a.extra||0))},
        {theme:'star',  v:(a.dreamy||0)+0.2*(a.free||0)}
      ].sort((x,y)=>y.v-x.v);
      return scores[0].theme;
    }
    const QUOTES = {
      earth: [{
        leader:"Red Cloud (Oglala Lakota)", nation:"Oglala Lakota",
        quote:"We do not want riches; we want our children trained and brought up properly.",
        ko:"우리는 부를 원하지 않습니다. 우리 아이들이 제대로 배우고 자라길 원합니다.",
        source:"Address at Cooper Union (1870)", url:"https://teachingamericanhistory.org/document/address-at-cooper-union-2/"
      }],
      water: [{
        leader:"Chief Joseph (Nez Perce)", nation:"Nez Perce",
        quote:"From where the sun now stands, I will fight no more forever.",
        ko:"지금 이 자리에서, 나는 더 이상 싸우지 않겠습니다.",
        source:"Surrender Statement (1877)", url:"https://teachingamericanhistory.org/document/i-will-fight-no-more-forever/"
      }],
      star: [{
        leader:"Sitting Bull (Hunkpapa Lakota)", nation:"Hunkpapa Lakota",
        quote:"Let us put our minds together and see what life we can make for our children.",
        ko:"우리 마음을 모아, 아이들을 위해 어떤 삶을 만들지 생각해 봅시다.",
        source:"Library of Congress", url:"https://www.loc.gov/pictures/item/2016648134/"
      }],
      wind: [{
        leader:"Luther Standing Bear (Oglala Lakota)", nation:"Oglala Lakota",
        quote:"The old Lakota was wise. He knew that man's heart, away from nature, becomes hard.",
        ko:"현명한 라코타는 알았어요. 자연과 멀어질수록 사람의 마음은 굳어진다는 것을.",
        source:"Land of the Spotted Eagle (1933)", url:"https://en.wikipedia.org/wiki/Luther_Standing_Bear"
      }],
      fire: [{
        leader:"Sarah Winnemucca (Northern Paiute)", nation:"Northern Paiute",
        quote:"I have nothing to say for myself, only for my people.",
        ko:"나 자신을 위한 말은 없습니다. 오직 내 사람들을 위한 말만 있습니다.",
        source:"Life Among the Piutes (1883)", url:"https://archive.org/details/lifeamongpiutesh00sara"
      }]
    };
    (function renderQuote(){
      const theme = pickThemeByAxes(axes);
      const pool = QUOTES[theme] || QUOTES.star;
      const q = pool[Math.floor(Math.random()*pool.length)];
      const el = document.getElementById('wisdom');
      el.innerHTML = `
        <small>전통의 말 · ${q.nation}</small>
        <div class="quote-text">“${q.quote}”</div>
        ${q.ko ? `<div style="font-size:13px;color:#6b7280;margin-top:6px;">${q.ko}</div>` : ``}
        <div class="quote-footer" style="margin-top:8px;">
          <div>— ${q.leader}</div>
          <a href="${q.url}" target="_blank" rel="noopener">출처: ${q.source}</a>
        </div>`;
    })();
  </script>
</body>
</html>

