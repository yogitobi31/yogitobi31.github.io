<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>결과 - 별바람 이름 테스트</title>
  <meta property="og:title" content="나의 별바람 이름 결과" />
  <meta property="og:type" content="website" />
  <meta property="og:description" content="나의 성향으로 탄생한 이름과 캐릭터를 확인해보세요!" />
  <meta property="og:image" content="assets/og_default.png" />
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/png" sizes="512x512" href="favicon-512.png">
  <meta property="og:image" content="og-default.png">
  <meta property="og:title" content="별바람 이름 테스트">
  <meta property="og:description" content="15문항 성향기반, 나만의 이름과 귀여운 캐릭터">

  <!-- AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4918757223156683"
     crossorigin="anonymous"></script>

  <!-- 명언 카드용 가벼운 스타일 -->
  <style>
    .quote-card{
      border-radius:16px; padding:18px 20px; background:#fffaf0;
      border:1px solid #ffe4b5; box-shadow:0 6px 18px rgba(0,0,0,.06); margin:16px 0;
    }
    .quote-card small{ color:#9CA3AF; letter-spacing:.3px; }
    .quote-text{ font-size:18px; line-height:1.5; font-weight:600; color:#374151; margin:10px 0; }
    .quote-footer{ display:flex; justify-content:space-between; align-items:center; gap:12px; }
    .quote-footer a{ font-size:12px; color:#2563EB; text-decoration:underline; white-space:nowrap; }
  </style>
</head>
<body>
  <header class="container">
    <h1>당신의 결과</h1>
  </header>

  <main class="container card result">
    <canvas id="charCanvas" width="900" height="900" class="canvas"></canvas>
    <div class="result-text">
      <h2 id="nameText">이름 로딩중...</h2>
      <p id="blurb">당신의 성향을 분석 중...</p>
      <div class="tags" id="tags"></div>

      <!-- ▼ 명언 카드가 여기에 렌더됩니다 -->
      <section id="wisdom" class="quote-card"></section>

      <div class="share">
        <button class="btn" id="downloadBtn">이미지 저장</button>
        <button class="btn ghost" id="shareBtn">공유하기</button>
      </div>
    </div>
  </main>

  <section class="container ad card">
    <!-- 네이티브 광고 자리 (AdSense 승인 후 삽입) -->
    <div class="ad-placeholder">여기에 광고가 표시됩니다</div>
  </section>

  <footer class="container footer">
    <a href="index.html">다시 테스트하기</a> · <a href="privacy.html">개인정보처리방침</a>
  </footer>

  <script src="data/name_parts.js"></script>
  <script src="data/character_layers.js"></script>
  <script src="app_result.js"></script>

  <!-- ▼ 성향→테마 매핑 + 명언 데이터 + 렌더 -->
  <script>
    // 성향 → 테마 매핑 (free/wind, lively/fire, warm/earth, 내향/water, dreamy/star)
    function pickThemeByAxes(axes){
      const scores = [
        {theme:'wind',  v:(axes.free||0)+0.3*(axes.dreamy||0)},
        {theme:'fire',  v:(axes.lively||0)+0.2*(axes.extra||0)},
        {theme:'earth', v:(axes.warm||0)+0.2*(1-(axes.free||0))},
        {theme:'water', v:(1-(axes.extra||0))},
        {theme:'star',  v:(axes.dreamy||0)+0.2*(axes.free||0)}
      ];
      scores.sort((a,b)=>b.v-a.v);
      return scores[0].theme;
    }

    // 테마별 명언 (검증된 3개 기본 포함; 이후 20+로 확장 예정)
    const SPIRIT_QUOTES_THEMED = {
      wind: [
        // 자유/여정/바람 관련 명언을 추후 추가
      ],
      fire: [
        // 열정/의지/도전 관련 명언을 추후 추가
      ],
      earth: [
        {
          leader: "Red Cloud (Oglala Lakota)",
          nation: "Oglala Lakota",
          quote: "We do not want riches, but we want our children trained and brought up properly.",
          source: "Address at Cooper Union (1870)",
          url: "https://teachingamericanhistory.org/document/address-at-cooper-union-2/"
        }
      ],
      water: [
        {
          leader: "Chief Joseph (Nez Perce)",
          nation: "Nez Perce",
          quote: "From where the sun now stands, I will fight no more forever.",
          source: "Teaching American History",
          url: "https://teachingamericanhistory.org/document/i-will-fight-no-more-forever/"
        }
      ],
      star: [
        {
          leader: "Sitting Bull (Hunkpapa Lakota)",
          nation: "Hunkpapa Lakota",
          quote: "Let us put our minds together and see what life we can make for our children.",
          source: "Library of Congress",
          url: "https://www.loc.gov/pictures/item/2016648134/"
        }
      ]
    };

    function getAxesFromLocalStorage(){
      try {
        const payload = JSON.parse(localStorage.getItem('resultPayload')||'null');
        return payload && payload.axes ? payload.axes : null;
      } catch(e){ return null; }
    }

    function pickQuote(){
      const axes = getAxesFromLocalStorage();
      const theme = axes ? pickThemeByAxes(axes) : 'star';
      const themed = SPIRIT_QUOTES_THEMED[theme] || [];
      const pool = themed.length ? themed : Object.values(SPIRIT_QUOTES_THEMED).flat();
      if (!pool.length) return null;
      return pool[Math.floor(Math.random()*pool.length)];
    }

    (function renderSpiritQuote(){
      const q = pickQuote();
      const el = document.getElementById('wisdom');
      if (!el || !q) return;
      el.innerHTML = `
        <small>전통의 말 · ${q.nation}</small>
        <div class="quote-text">“${q.quote}”</div>
        <div class="quote-footer">
          <div>— ${q.leader}</div>
          <a href="${q.url}" target="_blank" rel="noopener">출처: ${q.source}</a>
        </div>
      `;
    })();
  </script>
</body>
</html>
