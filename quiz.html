<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>테스트 시작 | 별바람</title>
<style>
  :root{--ink:#1f2937;--muted:#6b7280;--brand:#ef6b8c;--bg:#fffdf8}
  html,body{margin:0;background:var(--bg);color:var(--ink);
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif}
  .container{max-width:900px;margin:0 auto;padding:20px 16px}
  .card{background:#fff;border:1px solid #eee;border-radius:14px;padding:18px;box-shadow:0 6px 18px rgba(0,0,0,.06)}
  h1{margin:0 0 8px} .subtle{color:var(--muted);margin:0 0 14px}
  .q{margin:16px 0;padding:14px;border:1px solid #eee;border-radius:12px}
  .q h3{margin:0 0 10px;font-size:16px}
  .scale{display:flex;gap:8px;flex-wrap:wrap}
  label.scale-item{display:flex;align-items:center;gap:6px;background:#f8fafc;border:1px solid #e5e7eb;padding:8px 10px;border-radius:10px;cursor:pointer}
  .btn{display:inline-flex;align-items:center;gap:8px;border:0;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer}
  .btn.primary{background:var(--brand);color:#fff;box-shadow:0 6px 14px rgba(239,107,140,.25)}
  .btn.ghost{background:#f3f4f6}
  .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
  .hint{font-size:12px;color:#9CA3AF;margin-top:8px}
  .err{color:#b91c1c;font-weight:600;margin-top:8px}
</style>
</head>
<body>
  <header class="container">
    <h1>별바람 이름 테스트</h1>
    <p class="subtle">15문항 · 약 1분 · 결과는 내 기기에만 저장됩니다</p>
  </header>

  <main class="container card">
    <form id="form">
      <div id="questions"></div>
      <div class="actions">
        <button type="submit" class="btn primary">결과 보기</button>
        <a class="btn ghost" href="index.html">홈으로</a>
      </div>
      <div id="err" class="err" style="display:none;">모든 문항에 응답해 주세요.</div>
      <div class="hint">* 광고/서버로 응답이 전송되지 않으며, 결과는 브라우저(로컬 저장소)에 보관됩니다.</div>
    </form>
  </main>

  <script>
    // 15문항 정의 (각 문항은 어느 축에 기여하는지 axis로 표시)
    const ITEMS = [
      { id:'q1',  axis:'free',   text:'새로운 장소를 즉흥적으로 떠나는 편이다.' },
      { id:'q2',  axis:'extra',  text:'처음 만나는 사람과도 쉽게 대화한다.' },
      { id:'q3',  axis:'lively', text:'하루에 해야 할 일을 빠른 속도로 처리한다.' },
      { id:'q4',  axis:'warm',   text:'가까운 사람들의 감정 변화에 민감하다.' },
      { id:'q5',  axis:'dreamy', text:'공상/상상을 자주 하고 즐긴다.' },

      { id:'q6',  axis:'free',   text:'계획보다 흐름을 따르는 편이다.' },
      { id:'q7',  axis:'extra',  text:'모임에서 이야기의 중심이 되는 편이다.' },
      { id:'q8',  axis:'lively', text:'활동적인 취미를 선호한다.' },
      { id:'q9',  axis:'warm',   text:'돌봄/배려가 중요한 가치라고 느낀다.' },
      { id:'q10', axis:'dreamy', text:'예술/감성 콘텐츠를 즐겨 감상한다.' },

      { id:'q11', axis:'free',   text:'새 규칙을 보면 개선 아이디어가 먼저 떠오른다.' },
      { id:'q12', axis:'extra',  text:'단체 활동에서 에너지를 얻는다.' },
      { id:'q13', axis:'lively', text:'해야 할 일을 미루는 편이 아니다.' },
      { id:'q14', axis:'warm',   text:'충돌보다 화해를 우선한다.' },
      { id:'q15', axis:'dreamy', text:'밤하늘/자연을 보며 생각에 잠기곤 한다.' },
    ];

    const SCALE = [1,2,3,4,5]; // 매우 아니다(1) ~ 매우 그렇다(5)

    // 문항 렌더
    const box = document.getElementById('questions');
    ITEMS.forEach((it,idx)=>{
      const div = document.createElement('div');
      div.className = 'q';
      div.innerHTML = `
        <h3>${idx+1}. ${it.text}</h3>
        <div class="scale">
          ${SCALE.map(v => `
            <label class="scale-item">
              <input type="radio" name="${it.id}" value="${v}" required>
              <span>${v}</span>
            </label>
          `).join('')}
        </div>
      `;
      box.appendChild(div);
    });

    // 축 계산: 각 축 3문항 평균 → 0~1 정규화
    function computeAxes(formData){
      const sums = {free:0, extra:0, lively:0, warm:0, dreamy:0};
      const counts = {free:0, extra:0, lively:0, warm:0, dreamy:0};
      for (const it of ITEMS){
        const v = Number(formData.get(it.id)||0);
        if (!v) continue;
        sums[it.axis] += v; counts[it.axis] += 1;
      }
      const axes = {};
      for (const k of Object.keys(sums)){
        const avg = counts[k] ? (sums[k]/counts[k]) : 3; // 기본값 3
        const norm = (avg - 1) / 4; // 1~5 → 0~1
        axes[k] = Math.max(0, Math.min(1, norm));
      }
      return axes;
    }

    // 제출
    document.getElementById('form').addEventListener('submit', (e)=>{
      e.preventDefault();
      const fd = new FormData(e.currentTarget);
      // 모든 문항 체크
      for (const it of ITEMS){
        if (!fd.get(it.id)){
          document.getElementById('err').style.display='block';
          return;
        }
      }
      document.getElementById('err').style.display='none';

      const axes = computeAxes(fd);
      const payload = { axes, ts: Date.now() };
      try{
        localStorage.setItem('resultPayload', JSON.stringify(payload));
      }catch(_){}

      // 결과 페이지로 이동
      location.href = 'result.html';
    });
  </script>
</body>
</html>
